# 机器狗动作控制序列码文档

本文档详细列出了机器狗所有可执行动作的序列码、参数范围、执行前提要求以及JSON指令格式。

## 目录
- [一、基础控制动作](#一基础控制动作)
- [二、步态动作](#二步态动作)
- [三、特技动作](#三特技动作)
- [四、模式切换动作](#四模式切换动作)
- [五、原地模式下的姿态调整](#五原地模式下的姿态调整)
- [六、移动模式下的运动控制](#六移动模式下的运动控制)
- [七、传感器动作](#七传感器动作)
- [八、HTTP API使用说明](#八http-api使用说明)
- [九、查询动作执行反馈](#九查询动作执行反馈)

---

## 一、基础控制动作

### 1. 起立/趴下
- **序列码**: `0x21010202`
- **动作名称**: `ACTION_STAND_DOWN`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，在趴下状态和初始站立状态之间轮流切换
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010202"
    }
  ]
}
```

### 2. 回零
- **序列码**: `0x21010C05`
- **动作名称**: `ACTION_ZERO`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，初始化机器人关节
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010C05"
    }
  ]
}
```

### 3. 软急停
- **序列码**: `0x21020C0E`
- **动作名称**: `ACTION_EMERGENCY_STOP`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人软急停
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21020C0E"
    }
  ]
}
```

---

## 二、步态动作

### 1. 平地低速步态
- **序列码**: `0x21010300`
- **动作名称**: `ACTION_FLATLAND_SLOW_WALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从当前步态切换到低速步态
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010300"
    }
  ]
}
```

### 2. 平地中速步态
- **序列码**: `0x21010307`
- **动作名称**: `ACTION_FLATLAND_MEDIUM_WALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从当前步态切换到中速步态
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010307"
    }
  ]
}
```

### 3. 平地高速步态
- **序列码**: `0x21010303`
- **动作名称**: `ACTION_FLATLAND_FAST_WALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从当前步态切换到高速步态
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010303"
    }
  ]
}
```

### 4. 正常/匍匐
- **序列码**: `0x21010406`
- **动作名称**: `ACTION_NORMAL_CRAWL`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，在正常低速行走步态和匍匐低速行走步态之间切换
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010406"
    }
  ]
}
```

### 5. 抓地越障步态
- **序列码**: `0x21010402`
- **动作名称**: `ACTION_GRASPING_OBSTACLE_WALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从当前步态切换到抓地步态
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010402"
    }
  ]
}
```

### 6. 通用越障步态
- **序列码**: `0x21010401`
- **动作名称**: `ACTION_GENERAL_OBSTACLE_WALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从当前步态切换到通用步态
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010401"
    }
  ]
}
```

### 7. 高踏步越障步态
- **序列码**: `0x21010407`
- **动作名称**: `ACTION_HIGH_STEP_OBSTACLE_WALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从当前步态切换到高踏步步态
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010407"
    }
  ]
}
```

---

## 三、特技动作

### 1. 扭身体
- **序列码**: `0x21010204`
- **动作名称**: `ACTION_TWIST_BODY`
- **参数**: 无（通常为 `0`）
- **执行前提**: **力控状态（静止站立）**，执行状态为 `[6, 0, 2]`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010204"
    }
  ]
}
```

### 2. 翻身
- **序列码**: `0x21010205`
- **动作名称**: `ACTION_ROLL_OVER`
- **参数**: 无（通常为 `0`）
- **执行前提**: **趴下状态**，执行后状态为 `[1, 0, 0]`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010205"
    }
  ]
}
```

### 3. 太空步
- **序列码**: `0x2101030C`
- **动作名称**: `ACTION_MOONWALK`
- **参数**: 无（通常为 `0`）
- **执行前提**: **力控状态（静止站立）**，执行状态为 `[6, 12, 1]`，执行后需要额外等待4秒并发送收尾动作 `0x21010202`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x2101030C"
    }
  ]
}
```

### 4. 后空翻
- **序列码**: `0x21010502`
- **动作名称**: `ACTION_BACKFLIP`
- **参数**: 无（通常为 `0`）
- **执行前提**: **趴下状态**，执行后状态为 `[1, 0, 0]`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010502"
    }
  ]
}
```

### 5. 打招呼
- **序列码**: `0x21010507`
- **动作名称**: `ACTION_GREET`
- **参数**: 无（通常为 `0`）
- **执行前提**: **站立状态**，执行状态为 `[20, 0, 0]`，执行后可能进入过渡状态 `[25, 0, 0]` 或 `[5, 0, 0]`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010507"
    }
  ]
}
```

### 6. 向前跳
- **序列码**: `0x2101050B`
- **动作名称**: `ACTION_JUMP_FORWARD`
- **参数**: 无（通常为 `0`）
- **执行前提**: **趴下状态**，执行后状态为 `[1, 0, 0]`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x2101050B"
    }
  ]
}
```

### 7. 扭身跳
- **序列码**: `0x2101020D`
- **动作名称**: `ACTION_TWIST_JUMP`
- **参数**: 无（通常为 `0`）
- **执行前提**: **力控状态（静止站立）**，执行状态为 `[6, 0, 4]`
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x2101020D"
    }
  ]
}
```

---

## 四、模式切换动作

### 1. 原地模式
- **序列码**: `0x21010D05`
- **动作名称**: `ACTION_In_place_mode`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010D05"
    }
  ]
}
```

### 2. 移动模式
- **序列码**: `0x21010D06`
- **动作名称**: `ACTION_Mobile_mode`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010D06"
    }
  ]
}
```

### 3. 自主模式
- **序列码**: `0x21010C03`
- **动作名称**: `Autonomous_mode`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从手动模式切入自主模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010C03"
    }
  ]
}
```

### 4. 手动模式
- **序列码**: `0x21010C02`
- **动作名称**: `Manual_mode`
- **参数**: 无（通常为 `0`）
- **执行前提**: 无特殊要求，使机器人从自主模式切入手动模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010C02"
    }
  ]
}
```

---

## 五、原地模式下的姿态调整

**注意**: 以下动作需要在**原地模式**（`0x21010D05`）下执行。

### 1. 调整横滚角
- **序列码**: `0x21010131`
- **动作名称**: `ACTION_Adjust_the_roll_angle`
- **参数范围**: `[-12553, 12553]`
- **参数说明**: 正值向右翻滚，负值向左翻滚
- **执行前提**: 原地模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010131",
      "param": 1000,
      "semantic": "posture_roll"
    }
  ]
}
```

### 2. 调整俯仰角
- **序列码**: `0x21010130`
- **动作名称**: `ACTION_Adjust_the_pitch_angle`
- **参数范围**: `[-6553, 6553]`
- **参数说明**: 正值低头，负值抬头
- **执行前提**: 原地模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010130",
      "param": 500,
      "semantic": "posture_pitch"
    }
  ]
}
```

### 3. 调整身体高度
- **序列码**: `0x21010102`
- **动作名称**: `ACTION_Adjust_the_height_of_body`
- **参数范围**: `[-20000, 20000]`
- **参数说明**: 正值抬高身体，负值降低身体
- **执行前提**: 原地模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010102",
      "param": 1000
    }
  ]
}
```

### 4. 调整偏航角
- **序列码**: `0x21010135`
- **动作名称**: `ACTION_Adjust_the_yaw_angle`
- **参数范围**: `[-9553, 9553]`
- **参数说明**: 正值向右旋转，负值向左旋转
- **执行前提**: 原地模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010135",
      "param": 500,
      "semantic": "posture_yaw"
    }
  ]
}
```

---

## 六、移动模式下的运动控制

**注意**: 以下动作需要在**移动模式**（`0x21010D06`）下执行。

### 1. 左右平移
- **序列码**: `0x21010131`
- **动作名称**: `ACTION_Translate_left_and_right`
- **参数范围**: `[-12553, 12553]`
- **参数说明**: 指定机器人 y 轴上的期望线速度，正值向右，负值向左
- **执行前提**: 移动模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010131",
      "param": 1000,
      "semantic": "move_y"
    }
  ]
}
```

### 2. 前后平移
- **序列码**: `0x21010130`
- **动作名称**: `ACTION_pan_back_and_forth`
- **参数范围**: `[-6553, 6553]`
- **参数说明**: 指定机器人 x 轴上的期望线速度，正值向前，负值向后
- **执行前提**: 移动模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010130",
      "param": 1300,
      "semantic": "move_x"
    }
  ]
}
```

### 3. 左右转弯
- **序列码**: `0x21010135`
- **动作名称**: `ACTION_turn_left_and_right`
- **参数范围**: `[-9553, 9553]`
- **参数说明**: 指定机器人的期望角速度，正值向右转，负值向左转
- **执行前提**: 移动模式
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21010135",
      "param": -4500,
      "semantic": "move_yaw"
    }
  ]
}
```

---

## 七、传感器动作

### 超声波雷达
- **序列码**: `0x21012109`
- **动作名称**: `radar`
- **参数**: 无（通常为 `0`）
- **有效量程**: `[0.28m, 4.50m]`
- **说明**: 
  - 当障碍物距离小于 0.28m 时显示为 0.28m
  - 当障碍物距离大于 4.50m 时显示为 4.50m
- **执行前提**: 无特殊要求
- **JSON指令**:
```json
{
  "actions": [
    {
      "code": "0x21012109"
    }
  ]
}
```

---

## 八、HTTP API使用说明

### 1. 提交动作序列

**接口**: `POST /execute`

**请求格式**:
```json
{
  "actions": [
    {
      "code": "0x21010130",
      "param": 1300,
      "semantic": "move_x"
    },
    {
      "code": "0x21010204"
    }
  ]
}
```

**响应格式**:
```json
{
  "ok": true,
  "task_id": "a1b2c3d4e5f6..."
}
```

**示例（使用curl）**:
```bash
curl -X POST http://192.168.1.100:8000/execute \
  -H "Content-Type: application/json" \
  -d '{
    "actions": [
      {"code": "0x21010130", "param": 1300, "semantic": "move_x"},
      {"code": "0x21010204"}
    ]
  }'
```

**示例（使用PowerShell）**:
```powershell
$body = @{
    actions = @(
        @{ code = "0x21010130"; param = 1300; semantic = "move_x" },
        @{ code = "0x21010204" }
    )
} | ConvertTo-Json -Depth 10

Invoke-RestMethod -Uri "http://192.168.1.100:8000/execute" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

### 2. 急停

**接口**: `POST /emergency_stop`

**响应格式**:
```json
{
  "ok": true,
  "message": "已急停"
}
```

**示例（使用curl）**:
```bash
curl -X POST http://192.168.1.100:8000/emergency_stop
```

### 3. 健康检查

**接口**: `GET /health`

**响应格式**:
```json
{
  "ok": true
}
```

**示例（使用curl）**:
```bash
curl http://192.168.1.100:8000/health
```

---

## 九、查询动作执行反馈

### 1. 根据task_id查询执行结果

**接口**: `GET /result?task_id=<task_id>`

**响应格式**:
```json
{
  "ok": true,
  "task": {
    "task_id": "a1b2c3d4e5f6...",
    "status": "done",
    "payload": {
      "actions": [...]
    },
    "result": {
      "ok": true,
      "results": [
        {
          "ok": true,
          "index": 0,
          "code": "0x21010130",
          "param": 1300,
          "message": "动作执行成功",
          "started_at": 1234567890.123,
          "finished_at": 1234567895.456,
          "duration": 5.333
        },
        {
          "ok": true,
          "index": 1,
          "code": "0x21010204",
          "param": 0,
          "message": "动作执行成功",
          "started_at": 1234567895.456,
          "finished_at": 1234567900.789,
          "duration": 5.333
        }
      ]
    },
    "error": null,
    "created_at": 1234567890.000,
    "started_at": 1234567890.123,
    "finished_at": 1234567900.789,
    "worker_exitcode": null
  }
}
```

**任务状态说明**:
- `queued`: 任务已提交，等待执行
- `running`: 任务正在执行中
- `done`: 任务执行完成
- `failed`: 任务执行失败
- `cancelled`: 任务被取消（如急停）

**示例（使用curl）**:
```bash
# 替换 <task_id> 为实际的task_id
curl "http://192.168.1.100:8000/result?task_id=a1b2c3d4e5f6..."
```

**示例（使用PowerShell）**:
```powershell
$taskId = "a1b2c3d4e5f6..."
Invoke-RestMethod -Uri "http://192.168.1.100:8000/result?task_id=$taskId" `
  -Method GET
```

### 2. 完整使用流程示例

```bash
# 1. 提交动作序列
RESPONSE=$(curl -X POST http://192.168.1.100:8000/execute \
  -H "Content-Type: application/json" \
  -d '{
    "actions": [
      {"code": "0x21010202"},
      {"code": "0x21010204"}
    ]
  }')

# 2. 提取task_id（需要安装jq工具）
TASK_ID=$(echo $RESPONSE | jq -r '.task_id')

# 3. 等待一段时间后查询结果
sleep 5

# 4. 查询执行结果
curl "http://192.168.1.100:8000/result?task_id=$TASK_ID"
```

**PowerShell完整流程**:
```powershell
# 1. 提交动作序列
$body = @{
    actions = @(
        @{ code = "0x21010202" },
        @{ code = "0x21010204" }
    )
} | ConvertTo-Json -Depth 10

$response = Invoke-RestMethod -Uri "http://192.168.1.100:8000/execute" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body

# 2. 获取task_id
$taskId = $response.task_id
Write-Host "Task ID: $taskId"

# 3. 等待一段时间
Start-Sleep -Seconds 5

# 4. 查询执行结果
$result = Invoke-RestMethod -Uri "http://192.168.1.100:8000/result?task_id=$taskId" `
  -Method GET

# 5. 显示结果
$result.task | ConvertTo-Json -Depth 10
```

### 3. 轮询查询执行状态

```bash
#!/bin/bash
TASK_ID="a1b2c3d4e5f6..."
MAX_WAIT=60
INTERVAL=1
ELAPSED=0

while [ $ELAPSED -lt $MAX_WAIT ]; do
  RESULT=$(curl -s "http://192.168.1.100:8000/result?task_id=$TASK_ID")
  STATUS=$(echo $RESULT | jq -r '.task.status')
  
  echo "状态: $STATUS"
  
  if [ "$STATUS" = "done" ] || [ "$STATUS" = "failed" ] || [ "$STATUS" = "cancelled" ]; then
    echo "任务完成，最终状态: $STATUS"
    echo $RESULT | jq '.'
    break
  fi
  
  sleep $INTERVAL
  ELAPSED=$((ELAPSED + INTERVAL))
done
```

**PowerShell轮询脚本**:
```powershell
$taskId = "a1b2c3d4e5f6..."
$maxWait = 60
$interval = 1
$elapsed = 0

while ($elapsed -lt $maxWait) {
    try {
        $result = Invoke-RestMethod -Uri "http://192.168.1.100:8000/result?task_id=$taskId" -Method GET
        $status = $result.task.status
        
        Write-Host "状态: $status"
        
        if ($status -in @("done", "failed", "cancelled")) {
            Write-Host "任务完成，最终状态: $status"
            $result.task | ConvertTo-Json -Depth 10
            break
        }
    } catch {
        Write-Host "查询失败: $_"
    }
    
    Start-Sleep -Seconds $interval
    $elapsed += $interval
}
```

---

## 十、动作执行前提要求总结

### 状态要求分类

1. **趴下状态** (`lying`):
   - 翻身 (`0x21010205`)
   - 后空翻 (`0x21010502`)
   - 向前跳 (`0x2101050B`)

2. **力控状态（静止站立）** (`standing`):
   - 扭身体 (`0x21010204`)
   - 太空步 (`0x2101030C`)
   - 扭身跳 (`0x2101020D`)

3. **站立状态** (`standing`):
   - 打招呼 (`0x21010507`)

4. **原地模式** (`0x21010D05`):
   - 调整横滚角 (`0x21010131` - `posture_roll`)
   - 调整俯仰角 (`0x21010130` - `posture_pitch`)
   - 调整身体高度 (`0x21010102`)
   - 调整偏航角 (`0x21010135` - `posture_yaw`)

5. **移动模式** (`0x21010D06`):
   - 左右平移 (`0x21010131` - `move_y`)
   - 前后平移 (`0x21010130` - `move_x`)
   - 左右转弯 (`0x21010135` - `move_yaw`)

### 连续动作执行建议

在执行连续动作时，系统会自动：
1. 检查每个动作的执行前提状态
2. 自动切换到所需状态（如从站立切换到趴下）
3. 等待动作执行完成并状态稳定
4. 为下一个动作准备合适的状态

**示例：连续动作序列**:
```json
{
  "actions": [
    {"code": "0x21010130", "param": 1300, "semantic": "move_x"},
    {"code": "0x21010135", "param": -4500, "semantic": "move_yaw"},
    {"code": "0x21010130", "param": 1300, "semantic": "move_x"},
    {"code": "0x21010204"},
    {"code": "0x2101020D"},
    {"code": "0x2101050B"},
    {"code": "0x21010507"},
    {"code": "0x2101030C"},
    {"code": "0x21010130", "param": 1300, "semantic": "move_x"}
  ]
}
```

---

## 十一、注意事项

1. **参数范围**: 所有带参数的动作必须确保参数在指定范围内，超出范围可能导致动作异常
2. **状态切换**: 系统会自动处理状态切换，但建议在动作序列中明确指定模式切换动作
3. **执行顺序**: 动作按数组顺序依次执行，前一个动作完成后才会执行下一个
4. **超时处理**: 如果动作执行超时，系统会自动停止并继续执行下一个动作
5. **急停功能**: 可以通过 `/emergency_stop` 接口立即停止所有正在执行和排队的任务
6. **任务查询**: 建议保存 `task_id` 以便后续查询执行结果和调试

---

## 十二、快速参考表

| 动作名称 | 序列码 | 参数范围 | 前提状态 | 语义标识 |
|---------|--------|---------|---------|---------|
| 起立/趴下 | 0x21010202 | - | - | - |
| 回零 | 0x21010C05 | - | - | - |
| 软急停 | 0x21020C0E | - | - | - |
| 平地低速步态 | 0x21010300 | - | - | - |
| 平地中速步态 | 0x21010307 | - | - | - |
| 平地高速步态 | 0x21010303 | - | - | - |
| 正常/匍匐 | 0x21010406 | - | - | - |
| 抓地越障步态 | 0x21010402 | - | - | - |
| 通用越障步态 | 0x21010401 | - | - | - |
| 高踏步越障步态 | 0x21010407 | - | - | - |
| 扭身体 | 0x21010204 | - | 站立 | - |
| 翻身 | 0x21010205 | - | 趴下 | - |
| 太空步 | 0x2101030C | - | 站立 | - |
| 后空翻 | 0x21010502 | - | 趴下 | - |
| 打招呼 | 0x21010507 | - | 站立 | - |
| 向前跳 | 0x2101050B | - | 趴下 | - |
| 扭身跳 | 0x2101020D | - | 站立 | - |
| 原地模式 | 0x21010D05 | - | - | - |
| 移动模式 | 0x21010D06 | - | - | - |
| 自主模式 | 0x21010C03 | - | - | - |
| 手动模式 | 0x21010C02 | - | - | - |
| 调整横滚角 | 0x21010131 | [-12553,12553] | 原地模式 | posture_roll |
| 调整俯仰角 | 0x21010130 | [-6553,6553] | 原地模式 | posture_pitch |
| 调整身体高度 | 0x21010102 | [-20000,20000] | 原地模式 | - |
| 调整偏航角 | 0x21010135 | [-9553,9553] | 原地模式 | posture_yaw |
| 左右平移 | 0x21010131 | [-12553,12553] | 移动模式 | move_y |
| 前后平移 | 0x21010130 | [-6553,6553] | 移动模式 | move_x |
| 左右转弯 | 0x21010135 | [-9553,9553] | 移动模式 | move_yaw |
| 超声波雷达 | 0x21012109 | - | - | - |

---

**文档版本**: v1.0  
**最后更新**: 2026-01-14
